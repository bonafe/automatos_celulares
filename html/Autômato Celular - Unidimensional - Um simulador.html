<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">
<title>Automata Celular - 1</title>
</head>
<body>
	<canvas id="canvasPrincipal" width="1200" height="750" style="border:1px solid #000000;"></canvas>
	<br>
	<input type="button" onclick="gerarGeracaoRandomica()" value="Geração Randomica"></input>
	<input type="text" id="regra_1" value="0" onkeypress="atualizarRegras()" size="3"></input>
	<input type="text" id="regra_2" value="1" onkeypress="atualizarRegras()" size="3"></input>
	<input type="text" id="regra_3" value="1" onkeypress="atualizarRegras()" size="3"></input>
	<input type="text" id="regra_4" value="0" onkeypress="atualizarRegras()" size="3"></input>
	<input type="text" id="regra_5" value="1" onkeypress="atualizarRegras()" size="3"></input>
	<input type="text" id="regra_6" value="0" onkeypress="atualizarRegras()" size="3"></input>
	<input type="text" id="regra_7" value="1" onkeypress="atualizarRegras()" size="3"></input>
	<input type="text" id="regra_8" value="0" onkeypress="atualizarRegras()" size="3"></input>
	<script>
	
		class Universo{
			constructor (celulas, geracoes){
				this.regras = [0,1,1,0,1,0,1,0];
				this.geracao = 0;
				this.celulas = celulas;
				this.geracoes = geracoes;
				this.criarEspaco();
				this.inicializar();
			}
			
			atualizarRegras(regras){
				this.regras = regras;
			}
			
			criarEspaco(){
				this.espaco = new Array(this.geracoes);
				for (var geracao = 0; geracao < this.celulas; geracao++){
					this.espaco [geracao] = new Array (this.celulas).fill(0);
				}				
			}
			
			inicializar(){
				this.gerarGeracaoRandomica();
			}
			
			gerarGeracaoRandomica(){
				for (var celula = 0; celula < this.celulas; celula++){
					this.espaco[this.geracao][celula] = Math.round(Math.random());
				}
			}
			
			geracaoAnterior (geracao){
				var vGeracaoAnterior = geracao -1;
				if (vGeracaoAnterior < 0){
					vGeracaoAnterior = (this.geracoes-1);
				}
				return vGeracaoAnterior;
			}
			
			celulaAnterior(celula){
				
				var vCelulaAnterior = celula -1;
				if (vCelulaAnterior < 0){
					vCelulaAnterior = (this.celulas-1);
				}
				
				return vCelulaAnterior;
			}
			
			celulaPosterior(celula){
				
				var vCelulaPosterior = celula +1;
				if (vCelulaPosterior >= this.celulas){
					vCelulaPosterior = 0;
				}
				return vCelulaPosterior;
			}
			
			aplicarTempo(tempo){
				this.avancarGeracao();
				for (var celula = 0; celula < this.celulas; celula++){
					this.espaco[this.geracao][celula] = this.motorDeRegras(this.geracao, celula);
				}				
			}
					
			todosIguais (valor){
				for (var celula = 0; celula < this.celulas; celula++){
					if (this.espaco[this.geracao][celula] != valor){
						return false;
					}
				}	
				return true;
			}
			
			saturado(){
				return this.todosIguais(0) || this.todosIguais(1);
			}
			
			avancarGeracao(){
				this.geracao++;
				if (this.geracao >= this.geracoes){
					this.geracao = this.geracoes-1;
					this.espaco.shift();
					this.espaco.push(new Array(this.celulas).fill(0));
				}				
			}
				
			motorDeRegras(geracao, celula){
				
				var iGeracaoAnterior = this.geracaoAnterior(geracao);
				var a = this.espaco[iGeracaoAnterior][this.celulaAnterior(celula)];									
				var b = this.espaco[iGeracaoAnterior][celula];
				var c = this.espaco[iGeracaoAnterior][this.celulaPosterior(celula)];
				
				if      (a == 1 && b == 1 && c == 1) return this.regras[0];
				else if (a == 1 && b == 1 && c == 0) return this.regras[1];
				else if (a == 1 && b == 0 && c == 1) return this.regras[2];
				else if (a == 1 && b == 0 && c == 0) return this.regras[3];
				else if (a == 0 && b == 1 && c == 1) return this.regras[4];
				else if (a == 0 && b == 1 && c == 0) return this.regras[5];
				else if (a == 0 && b == 0 && c == 1) return this.regras[6];
				else if (a == 0 && b == 0 && c == 0) return this.regras[7];
			}
		}
	
		var tamanhoAresta = 10;
		var colunasPorLinha = 0;
		var linhasPorColuna = 0;
		var universo;
		var troca = false;
		
		function iniciar(){
			
			var canvas = document.getElementById("canvasPrincipal");			
			var largura = canvas.width;
			var altura = canvas.height;
			
			
			colunasPorLinha = largura / tamanhoAresta;
			linhasPorColuna = altura / tamanhoAresta;
			
			universo = new Universo(colunasPorLinha, linhasPorColuna);
		}
		
		iniciar();
		setInterval(desenhar, 10);
		
		function rgb(r, g, b){
		  return "rgb("+r+","+g+","+b+")";
		}
		
		
		function desenhar(){
			
			var canvas = document.getElementById("canvasPrincipal");
			var ctx = canvas.getContext("2d");
			
			for (var linha = 0; linha < linhasPorColuna; linha++){
				
				for (var coluna = 0; coluna < colunasPorLinha; coluna++){
			
					var cor; 
					
					if (universo.espaco[linha][coluna] == 1){					
						cor = (troca?rgb (255, 0, 0):rgb (0, 0, 255));
					}else{
						cor = rgb (0, 0, 0);
					}
					ctx.fillStyle =  cor;
															
					var x = coluna*tamanhoAresta;
					var y = linha*tamanhoAresta;
					ctx.fillRect (x, y, tamanhoAresta, tamanhoAresta);										
				}
			}
			universo.aplicarTempo(1);
			if (universo.saturado()){
				troca = !troca;
				universo.gerarGeracaoRandomica();
			}
		}
		function gerarGeracaoRandomica(){
			universo.gerarGeracaoRandomica();
		}
		
		function trazerValor(id){
			var resultado = parseInt(document.getElementById(id).value,10);
			if (Number.isNaN(resultado)){
				return 0;
			}
			return resultado;
		}
		
		function atualizarRegras(){
			var regras = [
					trazerValor("regra_1"),
					trazerValor("regra_2"),
					trazerValor("regra_3"),
					trazerValor("regra_4"),
					trazerValor("regra_5"),
					trazerValor("regra_6"),
					trazerValor("regra_7"),
					trazerValor("regra_8")
					];			
			universo.atualizarRegras (regras);			
		}
	</script>
</body>
</html>